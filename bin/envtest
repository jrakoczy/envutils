#!/usr/bin/env sh

is_absolute() {
    [[ "$1" = /* ]]
}

abosulute_path() {
    is_absolute "$1" && printf "$1" ||  printf "$(pwd)/$1"
}

subtract_git_path() {
    path="$(absolute_path $1)"
    printf "${path#$2}"
}

absolute_to_relative() {
    is_absolute "$1" && printf "$(basename $1)" || printf "$1"
}

source_relative_path() {
git_dir="$(git rev-parse --show-toplevel 2> /dev/null)" && \
    subtract_git_path "$1" "$git_dir"  || \
    absolute_to_relative "$1"
}

source_path() {
    [ -d "$1" ] && printf "${1%/}/*" || printf "$1"
}

target_path() {
    printf "$HOME/$(source_relative_path)"
}

link() {
    cp -asf "$1" "$2"
}

src="$1"
target="$2"

[ -z "$target" ] && \
    link "$src" "$target" || \
    link "$(source_path "$src")" "(target_path "$target")"
